(function(a,h){typeof exports=="object"&&typeof module<"u"?h(exports):typeof define=="function"&&define.amd?define(["exports"],h):(a=typeof globalThis<"u"?globalThis:a||self,h(a.FalconJS={}))})(this,function(a){"use strict";const h=[],w=()=>h[h.length-1]||null;function y(n,e){let o=n;const s=new Set,c=(e==null?void 0:e.equals)===!1?()=>!1:Object.is,t=`Signal[${n}]`;return[()=>{const r=w();if(r){const f=r.name||"effect"+Math.random().toString(36).substring(7);console.log(`%c${t}: Adding observer: ${f}`,"color: teal;"),s.add(r),r.dependencies.add(s)}return o},r=>{if(c(o,r))console.log(`%c${t}: Skipping update from ${o} to ${r} due to equals check.`,"color: gray;");else{const f=o;o=r,console.log(`%c${t}: Value set from ${f} to ${o}. Notifying ${s.size} observers.`,"color: red; font-weight: bold;"),new Set(s).forEach(i=>{const d=i.name||"effect"+Math.random().toString(36).substring(7);console.log(`%c${t}: Notifying observer: ${d}`,"color: red;"),typeof i=="function"?i():(console.warn(`${t}: Attempted to notify non-function observer:`,i),s.delete(i))})}}]}function C(n){console.log("createMemo: Initializing memo for function:",n.toString());let e,o=!1;const[s,c]=y(void 0,{equals:!1});return p(()=>{console.log("%ccreateMemo: Internal effect (B) START","color: blue;");const t=n();console.log("%c  Calculated newValue:","color: blue;",t),!o||!Object.is(e,t)?(console.log("%c  Value changed! Old:","color: blue;",e,"New:",t),e=t,o=!0,console.log("%c  Calling triggerMemo()","color: blue;"),c()):console.log("%c  Value NOT changed.","color: blue;"),console.log("%ccreateMemo: Internal effect (B) END","color: blue;")}),()=>{console.log("%ccreateMemo: Getter (C) called.","color: green;");const t=w(),l=t?t.name||"effect"+Math.random().toString(36).substring(7):"none";return console.log("%c  Current observer:","color: green;",l),s(),console.log("%c  Returning memoizedValue:","color: green;",e),e}}function T(n){for(const e of n.cleanups)try{e()}catch(o){console.error("Error during onCleanup function:",o)}n.cleanups.length=0;for(const e of n.dependencies)e.delete(n);n.dependencies.clear()}function p(n){const e=()=>{T(e),h.push(e);try{console.log("Effect Execute: Running user callback"),n()}catch(o){console.error("Error during effect execution:",o)}finally{h.pop(),console.log("Effect Execute: Finished, removed from stack.")}};e.dependencies=new Set,e.cleanups=[],console.log("createEffect: Scheduling initial execution with queueMicrotask"),queueMicrotask(e)}function F(n){const e=w();e?e.cleanups.push(n):console.warn("onCleanup was called outside of a reactive effect scope and will be ignored.")}function S(n,e){if(Array.isArray(e))e.forEach(o=>S(n,o));else if(e instanceof Node)n.appendChild(e);else if(typeof e=="string"||typeof e=="number")n.appendChild(document.createTextNode(e));else if(typeof e=="function"){const o=document.createTextNode("");p(()=>{o.textContent=e()}),n.appendChild(o)}else e==null||typeof e=="boolean"||console.warn("An unknown child type was passed to appendChild:",e)}function v(n,e,...o){if(typeof n=="function")return n({...e,children:o});const s=document.createElement(n);if(e)for(const[c,t]of Object.entries(e))c.startsWith("on")&&typeof t=="function"?s.addEventListener(c.substring(2).toLowerCase(),t):typeof t=="function"&&!c.startsWith("on")?p(()=>{const l=t();typeof l=="boolean"&&["checked","disabled","selected"].includes(c)?l?s.setAttribute(c,""):s.removeAttribute(c):s.setAttribute(c,l)}):c!=="children"&&s.setAttribute(c,t);return S(s,o),s}function x(n,e){e.innerHTML="";const o=n();S(e,o)}function M(n){return n instanceof Node?n:n==null||typeof n=="boolean"?document.createComment("falcon-empty-content"):document.createTextNode(String(n))}function R(n){var l;const e=(l=n.children)==null?void 0:l[0];if(typeof e!="function")return console.error("<For> component requires a function as its only child."),M(null);const o=document.createComment("falcon-for-start"),s=document.createComment("falcon-for-end");let c=new Map;p(()=>{const m=n.each(),r=o.parentNode;if(!Array.isArray(m)||!r)return;const f=new Map,g=[];for(let d=0;d<m.length;d++){const u=m[d],b=u.id,N=c.get(b);if(N)g.push(N),f.set(b,N),c.delete(b);else{const k=M(e(u,d));k._falcon_item_key_=b,g.push(k),f.set(b,k)}}let i=o.nextSibling;for(const d of g)i===d?i=i.nextSibling:r.insertBefore(d,i);for(;i!==s;){const d=i.nextSibling,u=i._falcon_item_key_;c.has(u)&&r.removeChild(i),i=d}c=f});const t=document.createDocumentFragment();return t.appendChild(o),t.appendChild(s),t}function E(n){const{when:e,fallback:o,children:s}=n,c=document.createComment("falcon-show");let t=[];const l=C(()=>!!e());return p(()=>{const m=l(),r=c.parentNode;if(!r)return;t.length>0&&t.forEach(u=>{u.parentNode===r&&r.removeChild(u)}),t=[];const f=m?s:o,g=document.createDocumentFragment();function i(u){Array.isArray(u)?u.forEach(i):typeof u=="function"?i(u()):u instanceof Node?g.appendChild(u):u!=null&&typeof u!="boolean"&&g.appendChild(document.createTextNode(String(u)))}i(f);const d=Array.from(g.childNodes);r.insertBefore(g,c.nextSibling),t=d}),c}function V(n){const[e,o]=y(void 0),[s,c]=y(!1),[t,l]=y(null);p(async()=>{c(!0),l(null);try{const f=await n();o(f)}catch(f){console.error("[createResource] Fetching failed:",f),l(f)}finally{c(!1)}});const r=()=>e();return r.loading=()=>s(),r.error=()=>t(),r}const[D,A]=y(window.location.pathname);window.addEventListener("popstate",()=>{A(window.location.pathname)});function $(n){window.history.pushState({},"",n),A(n)}function L(n){const{path:e,children:o}=n,s=C(()=>D()===e);return E({when:s,children:o})}function O(n){const{to:e,children:o}=n;return v("a",{href:e,onclick:c=>{c.preventDefault(),$(e)}},o)}function _(n){const e={},o={get(t,l){if(l in t)return t[l][0]();console.warn(`[Store] Property "${l}" does not exist on the store.`)},set(){return console.warn("[Store] Direct mutation is not allowed. Use the setter function instead."),!1}};for(const t in n)e[t]=y(n[t]);return[new Proxy(e,o),t=>{const l={};for(const r in e)l[r]=e[r][0]();const m=typeof t=="function"?t(l):t;for(const r in m)r in e?e[r][1](m[r]):console.warn(`[Store] Cannot set property "${r}" that was not in the initial state.`)}]}a.For=R,a.Link=O,a.Route=L,a.Show=E,a.createEffect=p,a.createFalconElement=v,a.createMemo=C,a.createResource=V,a.createSignal=y,a.createStore=_,a.navigate=$,a.onCleanup=F,a.render=x,Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=falcon.umd.js.map
